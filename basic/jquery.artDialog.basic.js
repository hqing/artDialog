/*!
 * artDialog basic
 * Date: 2011-08-29 17:25
 * http://code.google.com/p/artdialog/
 * (c) 2009-2011 TangBin, http://www.planeArt.cn
 *
 * This is licensed under the GNU LGPL, version 2.1 or later.
 * For details, see: http://creativecommons.org/licenses/LGPL/2.1/
 */(function(a,b,c){a.noop=a.noop||function(){};var d,e=0,f=a(b),g=a(document),h=document.documentElement,i=b.VBArray&&!b.XMLHttpRequest,j="createTouch"in document&&!("onmousemove"in h)||/(iPhone|iPad|iPod)/i.test(navigator.userAgent),k=!i&&!j,l="artDialog"+(new Date).getTime(),m=function(b,f,g){b=b||{};if(typeof b=="string"||b.nodeType===1)b={content:b,fixed:!j};var h,i=[],n=m.defaults,o=b.follow=this.nodeType===1&&this||b.follow;for(var p in n)b[p]===c&&(b[p]=n[p]);return a.each({ok:"yesFn",cancel:"noFn",close:"closeFn",init:"initFn",okVal:"yesText",cancelVal:"noText"},function(a,d){b[a]=b[a]!==c?b[a]:b[d]}),typeof o=="string"&&(o=a(o)[0]),b.id=o&&o[l+"follow"]||b.id||l+e,h=m.list[b.id],o&&h?h.follow(o).focus():h?h.focus():(k||(b.fixed=!1),a.isArray(b.button)||(b.button=b.button?[b.button]:[]),f!==c&&(b.ok=f),g!==c&&(b.cancel=g),b.ok&&b.button.push({name:b.okVal,callback:b.ok,focus:!0}),b.cancel&&b.button.push({name:b.cancelVal,callback:b.cancel}),m.defaults.zIndex=b.zIndex,e++,m.list[b.id]=d?d._init(b):new m.fn._init(b))};m.fn=m.prototype={_init:function(a){var c=this,e;return c._isRun=!0,c.config=a,c.DOM=e=c.DOM||c._getDOM(),e.wrap.addClass(a.skin),e.wrap.css("position",a.fixed?"fixed":"absolute"),e.close[a.cancel===!1?"hide":"show"](),e.se.css("cursor",a.resize?"se-resize":"auto"),e.title.css("cursor",a.drag?"move":"auto"),e.content.css("padding",a.padding),c[a.show?"show":"hide"](!0).button(a.button).title(a.title).content(a.content).size(a.width,a.height).time(a.time),a.follow?c.follow(a.follow):c.position(),c.focus(a.focus),a.lock&&c.lock(),c._addEvent(),d=null,a.init&&a.init.call(c,b),c},content:function(a){var b,d,e,f,g=this,h=g.DOM.content,i=h[0];return g._elemBack&&g._elemBack(),a===c?i:(typeof a=="string"?h.html(a):a&&a.nodeType===1&&(f=a.style.display,b=a.previousSibling,d=a.nextSibling,e=a.parentNode,g._elemBack=function(){b&&b.parentNode?b.parentNode.insertBefore(a,b.nextSibling):d&&d.parentNode?d.parentNode.insertBefore(a,d):e&&e.appendChild(a),a.style.display=f,g._elemBack=null},h.html(""),i.appendChild(a),a.style.display="block"),g.position())},title:function(a){var b=this.DOM,d=b.wrap,e=b.title,f="aui_state_noTitle";return a===c?e[0]:(a===!1?(e.hide().html(""),d.addClass(f)):(e.show().html(a),d.removeClass(f)),this)},position:function(){var a=this,b=a.DOM.wrap[0],c=a.config.fixed,d=c?0:g.scrollLeft(),e=c?0:g.scrollTop(),h=f.width(),i=f.height(),j=b.offsetWidth,k=b.offsetHeight,l=(h-j)/2+d,m=m=(k<4*i/7?i*.382-k/2:(i-k)/2)+e,n=b.style;return n.left=Math.max(l,d)+"px",n.top=Math.max(m,e)+"px",a},size:function(a,b){var c=this.DOM.main[0].style;return typeof a=="number"&&(a=a+"px"),typeof b=="number"&&(b=b+"px"),c.width=a,c.height=b,this},follow:function(b){var c,d=this,e=d.config;if(typeof b=="string"||b&&b.nodeType===1)c=a(b),b=c[0];if(!b||!b.offsetWidth&&!b.offsetHeight)return d.position(d._left,d._top);var h=e.fixed,i=l+"follow",j=f.width(),k=f.height(),m=g.scrollLeft(),n=g.scrollTop(),o=c.offset(),p=b.offsetWidth,q=b.offsetHeight,r=h?o.left-m:o.left,s=h?o.top-n:o.top,t=d.DOM.wrap[0],u=t.style,v=t.offsetWidth,w=t.offsetHeight,x=r-(v-p)/2,y=s+q,z=h?0:m,A=h?0:n;return x=x<z?r:x+v>j&&r-v>z?r-v+p:x,y=y+w>k+A&&s-w>A?s-w:y,u.left=x+"px",u.top=y+"px",d._follow&&d._follow.removeAttribute(i),d._follow=b,b[i]=e.id,d},button:function(){var b=this,d=arguments,e=b.DOM,f=e.wrap,g=e.buttons,h=g[0],i="aui_state_highlight",j=b._listeners=b._listeners||{},k=a.isArray(d[0])?d[0]:[].slice.call(d);return d[0]===c?h:(a.each(k,function(c,d){var e=d.name,f=!j[e],g=f?document.createElement("button"):j[e].elem;j[e]||(j[e]={}),d.callback&&(j[e].callback=d.callback),d.className&&(g.className=d.className),d.focus&&(b._focus&&b._focus.removeClass(i),b._focus=a(g).addClass(i),b.focus()),g[l+"callback"]=e,g.disabled=!!d.disabled,f&&(g.innerHTML=e,j[e].elem=g,h.appendChild(g))}),g[0].style.display=k.length?"":"none",b)},show:function(){return this.DOM.wrap.show(),!arguments[0]&&this._lockMaskWrap&&this._lockMaskWrap.show(),this},hide:function(){return this.DOM.wrap.hide(),!arguments[0]&&this._lockMaskWrap&&this._lockMaskWrap.hide(),this},close:function(){var a=this,c=a.DOM,e=c.wrap,f=m.list,g=a.config.close,h=a.config.follow;if(a._isClose)return a;a.time();if(typeof g=="function"&&g.call(a,b)===!1)return a;a.unlock(),a._elemBack&&a._elemBack(),e[0].className=e[0].style.cssText="",c.title.html(""),c.content.html(""),c.buttons.html(""),m.focus===a&&(m.focus=null),h&&h.removeAttribute(l+"follow"),delete f[a.config.id],a._isClose=!0,a._removeEvent(),a.hide(!0);for(var i in a)a.hasOwnProperty(i)&&i!=="DOM"&&delete a[i];return d?e.remove():d=a,a},time:function(a){var b=this,c=b.config.cancelVal,d=b._timer;return d&&clearTimeout(d),a&&(b._timer=setTimeout(function(){b._trigger(c)},1e3*a)),b},focus:function(){var a,b=this,c=b.DOM,d=c.wrap,e=m.focus,f=m.defaults.zIndex++;d.css("zIndex",f),b._lockMask&&b._lockMask.css("zIndex",f-1),e&&e.DOM.wrap.removeClass("aui_state_focus"),m.focus=b,d.addClass("aui_state_focus");if(!arguments[0])try{a=b._focus&&b._focus[0]||c.close[0],a&&a.focus()}catch(g){}return b},lock:function(){if(this._lock)return this;var b=this,c=m.defaults.zIndex-1,d=b.DOM.wrap,e=b.config,h="filter:alpha(opacity="+e.opacity*100+");opacity:"+e.opacity,i=f.width(),j=g.height(),l=b._lockMaskWrap||a(document.body.appendChild(document.createElement("div"))),n=b._lockMask||a(l[0].appendChild(document.createElement("div"))),o=k?"position:fixed;width:100%;height:100%":"position:absolute;width:"+i+"px;height:"+j+"px";return b.focus(!0),d.addClass("aui_state_lock"),l[0].style.cssText=o+";z-index:"+c+";top:0;left:0;overflow:hidden;",n[0].style.cssText="height:100%;background:"+e.background+";"+h,n[0].ondblclick=function(){b.close()},b._lockMaskWrap=l,b._lockMask=n,b._lock=!0,b},unlock:function(){var a=this;return a._lock?(a.DOM.wrap.removeClass("aui_state_lock"),a._lockMask[0].ondblclick=null,a._lockMaskWrap.hide(),a._lock=!1,d&&(a._lockMaskWrap.remove(),a._lockMaskWrap=a._lockMask=null),a):a},_getDOM:function(){var b=document.createElement("div");b.style.cssText="position:absolute;left:0;top:0",b.innerHTML=m.templates,document.body.appendChild(b);var c,d=0,e={wrap:a(b)},f=b.getElementsByTagName("*"),g=f.length;for(;d<g;d++)c=f[d].className.split("aui_")[1],c&&(e[c]=a(f[d]));return e},_trigger:function(a){var b=this,c=b._listeners[a]&&b._listeners[a].callback;return typeof c!="function"||c.call(b)!==!1?b.close():b},_addEvent:function(){var a,b,c=this,d=c.DOM,e="all"in document,g=f.width()*f.height();a=function(){var a,b=g,d=c.config.follow;if(e){a=f.width()*f.height(),g=a;if(b===a)return}d?c.follow(d):c.position()},c._winResize=function(){b&&clearTimeout(b),b=setTimeout(function(){a()},40)},f.bind("resize",c._winResize),d.wrap.bind("click",function(a){var b=a.target,e;if(b.disabled)return!1;if(b===d.close[0])return c._trigger(c.config.cancelVal),!1;e=b[l+"callback"],e&&c._trigger(e)}).bind("mousedown",function(){c.focus(!0)})},_removeEvent:function(){var a=this,b=a.DOM;b.wrap.unbind(),f.unbind("resize",a._winResize)}},m.fn._init.prototype=m.fn,a.fn.dialog=a.fn.artDialog=function(){var a=arguments;return this[this.live?"live":"bind"]("click",function(){return m.apply(this,a),!1}),this},m.focus=null,m.list={},g.bind("keydown",function(a){var b=a.target,c=b.nodeName,d=/^INPUT|TEXTAREA$/,e=m.focus,f=a.keyCode;if(!e||!e.config.esc||d.test(c))return;f===27&&e._trigger(e.config.cancelVal)}),m.templates='<div class="aui_outer"><table class="aui_border"><tbody><tr><td class="aui_nw"></td><td class="aui_n"></td><td class="aui_ne"></td></tr><tr><td class="aui_w"></td><td class="aui_center"><table class="aui_inner"><tbody><tr><td class="aui_header"><div class="aui_titleBar"><div class="aui_title"></div><a class="aui_close" href="javascript:/*artDialog*/;">\u00d7</a></div></td></tr><tr><td class="aui_main"><div class="aui_content"></div></td></tr><tr><td class="aui_footer"><div class="aui_buttons"></div></td></tr></tbody></table></td><td class="aui_e"></td></tr><tr><td class="aui_sw"></td><td class="aui_s"></td><td class="aui_se"></td></tr></tbody></table></div>',m.defaults={content:'<div class="aui_loading"><span>loading..</span></div>',title:"\u6d88\u606f",button:null,ok:null,cancel:null,init:null,close:null,okVal:"\u786e\u5b9a",cancelVal:"\u53d6\u6d88",width:"auto",height:"auto",padding:"20px 25px",skin:"",time:null,esc:!0,focus:!0,show:!0,follow:null,lock:!1,background:"#000",opacity:.7,fixed:!1,zIndex:1987},b.artDialog=a.dialog=a.artDialog=m})(window.jQuery&&(window.art=jQuery)||window.art,this)